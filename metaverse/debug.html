<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è°ƒè¯•ä¿¡æ¯</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
            font-family: 'Courier New', monospace;
        }
        .debug-panel {
            background: #2a2a2a;
            border: 1px solid #4facfe;
            border-radius: 8px;
            padding: 20px;
            margin: 10px 0;
        }
        .status-ok { color: #4ade80; }
        .status-error { color: #ef4444; }
        .status-warning { color: #facc15; }
        .refresh-btn {
            background: #4facfe;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 0;
        }
        .refresh-btn:hover {
            background: #3b82f6;
        }
        pre {
            background: #111;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ å…ƒå®‡å®™é¡¹ç›®è°ƒè¯•å·¥å…·</h1>
    
    <button class="refresh-btn" onclick="checkStatus()">åˆ·æ–°çŠ¶æ€</button>
    
    <div class="debug-panel">
        <h2>ğŸ“Š ç³»ç»ŸçŠ¶æ€</h2>
        <div id="status-display">æ­£åœ¨æ£€æŸ¥...</div>
    </div>

    <div class="debug-panel">
        <h2>ğŸŒ ç½‘ç»œçŠ¶æ€</h2>
        <div id="network-status">æ­£åœ¨æ£€æŸ¥...</div>
    </div>

    <div class="debug-panel">
        <h2>ğŸ® æ¸¸æˆå¯¹è±¡çŠ¶æ€</h2>
        <div id="game-objects">æ­£åœ¨æ£€æŸ¥...</div>
    </div>

    <div class="debug-panel">
        <h2>ğŸ” é”™è¯¯æ—¥å¿—</h2>
        <pre id="error-log">æ— é”™è¯¯è®°å½•</pre>
    </div>

    <script>
        // é”™è¯¯æ—¥å¿—æ”¶é›†
        const errorLog = [];
        const originalError = console.error;
        console.error = function(...args) {
            errorLog.push({
                timestamp: new Date().toISOString(),
                message: args.join(' ')
            });
            originalError.apply(console, args);
            updateErrorLog();
        };

        function checkStatus() {
            checkSystemStatus();
            checkNetworkStatus();
            checkGameObjects();
        }

        function checkSystemStatus() {
            const statusDiv = document.getElementById('status-display');
            let html = '<ul>';
            
            // æ£€æŸ¥æµè§ˆå™¨æ”¯æŒ
            html += `<li>WebGLæ”¯æŒ: <span class="${supportsWebGL() ? 'status-ok' : 'status-error'}">${supportsWebGL() ? 'âœ“' : 'âœ—'}</span></li>`;
            html += `<li>Pointer Lockæ”¯æŒ: <span class="${supportsPointerLock() ? 'status-ok' : 'status-error'}">${supportsPointerLock() ? 'âœ“' : 'âœ—'}</span></li>`;
            html += `<li>Web Audioæ”¯æŒ: <span class="${supportsWebAudio() ? 'status-ok' : 'status-error'}">${supportsWebAudio() ? 'âœ“' : 'âœ—'}</span></li>`;
            html += `<li>æœ¬åœ°å­˜å‚¨æ”¯æŒ: <span class="${supportsLocalStorage() ? 'status-ok' : 'status-error'}">${supportsLocalStorage() ? 'âœ“' : 'âœ—'}</span></li>`;
            
            html += '</ul>';
            statusDiv.innerHTML = html;
        }

        function checkNetworkStatus() {
            const networkDiv = document.getElementById('network-status');
            let html = '<ul>';
            
            html += `<li>ç½‘ç»œçŠ¶æ€: <span class="${navigator.onLine ? 'status-ok' : 'status-error'}">${navigator.onLine ? 'åœ¨çº¿' : 'ç¦»çº¿'}</span></li>`;
            
            // æ£€æŸ¥CDNå¯ç”¨æ€§
            checkCDNAvailability();
            
            html += '</ul>';
            networkDiv.innerHTML = html;
        }

        async function checkCDNAvailability() {
            const cdnUrls = [
                'https://cdnjs.cloudflare.com/ajax/libs/three.js/r158/three.min.js',
                'https://unpkg.com/three@0.158.0/build/three.min.js'
            ];
            
            for (const url of cdnUrls) {
                try {
                    const response = await fetch(url, { method: 'HEAD' });
                    console.log(`CDNæ£€æŸ¥ - ${url}: ${response.ok ? 'å¯ç”¨' : 'ä¸å¯ç”¨'}`);
                } catch (error) {
                    console.log(`CDNæ£€æŸ¥ - ${url}: ä¸å¯ç”¨ (${error.message})`);
                }
            }
        }

        function checkGameObjects() {
            const gameDiv = document.getElementById('game-objects');
            let html = '<ul>';
            
            // æ£€æŸ¥THREE.js
            html += `<li>THREE.js: <span class="${typeof THREE !== 'undefined' ? 'status-ok' : 'status-error'}">${typeof THREE !== 'undefined' ? 'å·²åŠ è½½' : 'æœªåŠ è½½'}</span></li>`;
            
            if (typeof THREE !== 'undefined') {
                html += `<li>THREE.jsç‰ˆæœ¬: <span class="status-ok">${THREE.REVISION}</span></li>`;
            }
            
            // æ£€æŸ¥æ¸¸æˆå¯¹è±¡
            html += `<li>MetaverseSceneç±»: <span class="${typeof MetaverseScene !== 'undefined' ? 'status-ok' : 'status-error'}">${typeof MetaverseScene !== 'undefined' ? 'å·²å®šä¹‰' : 'æœªå®šä¹‰'}</span></li>`;
            html += `<li>GameManagerç±»: <span class="${typeof GameManager !== 'undefined' ? 'status-ok' : 'status-error'}">${typeof GameManager !== 'undefined' ? 'å·²å®šä¹‰' : 'æœªå®šä¹‰'}</span></li>`;
            
            // æ£€æŸ¥å®ä¾‹
            html += `<li>gameå®ä¾‹: <span class="${window.game ? 'status-ok' : 'status-warning'}">${window.game ? 'å·²åˆ›å»º' : 'æœªåˆ›å»º'}</span></li>`;
            html += `<li>metaverseå®ä¾‹: <span class="${window.metaverse ? 'status-ok' : 'status-warning'}">${window.metaverse ? 'å·²åˆ›å»º' : 'æœªåˆ›å»º'}</span></li>`;
            
            // æ£€æŸ¥DOMå…ƒç´ 
            html += `<li>Canvaså…ƒç´ : <span class="${document.getElementById('three-canvas') ? 'status-ok' : 'status-error'}">${document.getElementById('three-canvas') ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}</span></li>`;
            
            html += '</ul>';
            gameDiv.innerHTML = html;
        }

        function updateErrorLog() {
            const errorLogDiv = document.getElementById('error-log');
            if (errorLog.length === 0) {
                errorLogDiv.textContent = 'æ— é”™è¯¯è®°å½•';
                return;
            }
            
            errorLogDiv.textContent = errorLog.map(error => 
                `[${error.timestamp}] ${error.message}`
            ).join('\n');
        }

        // æ”¯æŒæ£€æŸ¥å‡½æ•°
        function supportsWebGL() {
            try {
                const canvas = document.createElement('canvas');
                return !!(window.WebGLRenderingContext && canvas.getContext('webgl'));
            } catch (e) {
                return false;
            }
        }

        function supportsPointerLock() {
            return 'pointerLockElement' in document || 'mozPointerLockElement' in document || 'webkitPointerLockElement' in document;
        }

        function supportsWebAudio() {
            return !!(window.AudioContext || window.webkitAudioContext);
        }

        function supportsLocalStorage() {
            try {
                return 'localStorage' in window && window.localStorage !== null;
            } catch (e) {
                return false;
            }
        }

        // å®šæœŸæ›´æ–°çŠ¶æ€
        setInterval(checkStatus, 5000);

        // åˆå§‹æ£€æŸ¥
        checkStatus();

        // ç›‘å¬ç½‘ç»œçŠ¶æ€å˜åŒ–
        window.addEventListener('online', checkNetworkStatus);
        window.addEventListener('offline', checkNetworkStatus);
    </script>
</body>
</html> 