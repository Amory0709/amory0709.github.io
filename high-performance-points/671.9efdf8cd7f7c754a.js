(()=>{"use strict";const s=self;s.onmessage=h=>{try{const{type:n,filters:t,properties:p,dimensions:M}=h.data;if("generate"!==n)return void console.error("[Worker] Unknown message type:",n);const m=performance.now(),{width:$,height:v,depth:w}=M,e=$*v*w;console.log("[Worker] Starting mask generation..."),console.log(`  - Voxels: ${e.toLocaleString()}`),console.log(`  - Filters: ${t.filter(o=>o.enabled).length}`);const r=new Uint8Array(e),d=t.filter(o=>o.enabled);if(0===d.length){r.fill(255);const o=performance.now()-m;return void s.postMessage({type:"complete",mask:r,stats:{total:e,visible:e,filtered:0,duration:o}},[r.buffer])}const u=1e5;let l=0;for(let o=0;o<e;o+=u){const a=Math.min(o+u,e);for(let i=o;i<a;i++){let c=!0;for(const g of d){const b=p[g.propertyName];if(!b){console.warn(`[Worker] Property not found: ${g.propertyName}`),c=!1;break}const y=b[i];if(y<g.min||y>g.max){c=!1;break}}r[i]=c?255:0,c&&l++}const F={type:"progress",value:Math.floor(a/e*100)};s.postMessage(F)}const k=performance.now()-m,f=e-l;console.log("[Worker] Mask generation complete!"),console.log(`  - Visible: ${l.toLocaleString()} (${(l/e*100).toFixed(1)}%)`),console.log(`  - Filtered: ${f.toLocaleString()} (${(f/e*100).toFixed(1)}%)`),console.log(`  - Duration: ${k.toFixed(2)}ms`),s.postMessage({type:"complete",mask:r,stats:{total:e,visible:l,filtered:f,duration:k}},[r.buffer])}catch(n){const t=n;console.error("[Worker] Unhandled error:",t);const p={type:"error",message:t?.message??String(n),stack:t?.stack??null};s.postMessage(p)}}})();